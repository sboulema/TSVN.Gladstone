<DataTemplate xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml"
              xmlns:styles="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
              xmlns:colors="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0">
    <DataTemplate.Resources>
        <Style TargetType="TreeView" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogTreeViewStyleKey}}" />
        <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogTreeViewItemStyleKey}}">
            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
            <Setter Property="IsExpanded" Value="True"/>
        </Style>
    </DataTemplate.Resources>
    <Border Background="{DynamicResource {x:Static colors:EnvironmentColors.ToolWindowBackgroundBrushKey}}"
            TextElement.Foreground="{DynamicResource {x:Static colors:EnvironmentColors.ToolWindowTextBrushKey}}"
            Padding="5">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="{Binding ChangesHeader}" FontWeight="Bold" Margin="0,0,0,5" />
            <TreeView Grid.Row="1" ItemsSource="{Binding Items}" BorderThickness="0">
                <TreeView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </TreeView.ItemsPanel>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                            <vs:Image Source="{Binding Moniker}" Grid.Column="0" Margin="0,0,5,0" />
                            <TextBlock x:Name="ChangeLabel" Text="{Binding Path=Label}" Grid.Column="1" HorizontalAlignment="Stretch" />
                            <TextBlock x:Name="ChangeType" Text="{Binding Path=ChangeType}" Grid.Column="2" Margin="15,0,0,0" />
                            <StackPanel.ContextMenu>
                                <ContextMenu Style="{DynamicResource {x:Static styles:VsResourceKeys.ContextMenuStyleKey}}">
                                    <MenuItem Header="Clear" Command="{Binding ClearCommand}">
                                        <MenuItem.Icon>
                                            <vs:Image Source="KnownMonikers.ClearWindowContent" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <MenuItem Header="Default message" Command="{Binding DefaultTextCommand}">
                                        <MenuItem.Icon>
                                            <vs:Image Source="DefaultText" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </ContextMenu>
                            </StackPanel.ContextMenu>
                        </StackPanel>
                        <HierarchicalDataTemplate.Triggers>
                            <DataTrigger Binding="{Binding HasChildren}" Value="True">
                                <Setter TargetName="ChangeLabel" Property="Foreground" Value="{DynamicResource {x:Static colors:EnvironmentColors.CommandBarTextInactiveBrushKey}}" />
                                <Setter TargetName="ChangeType" Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                        </HierarchicalDataTemplate.Triggers>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Grid>
    </Border>
</DataTemplate>
